"use strict";(()=>{var Fn=Object.create;var dt=Object.defineProperty;var Hn=Object.getOwnPropertyDescriptor;var Bn=Object.getOwnPropertyNames;var qn=Object.getPrototypeOf,Vn=Object.prototype.hasOwnProperty;var jn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Xn=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Bn(t))!Vn.call(e,o)&&o!==n&&dt(e,o,{get:()=>t[o],enumerable:!(r=Hn(t,o))||r.enumerable});return e};var vt=(e,t,n)=>(n=e!=null?Fn(qn(e)):{},Xn(t||!e||!e.__esModule?dt(n,"default",{value:e,enumerable:!0}):n,e));var je=jn((Qr,Se)=>{(function(){"use strict";var e={}.hasOwnProperty;function t(){for(var o="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(o=r(o,n(a)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var i="";for(var a in o)e.call(o,a)&&o[a]&&(i=r(i,a));return i}function r(o,i){return i?o?o+" "+i:o+i:o}typeof Se<"u"&&Se.exports?(t.default=t,Se.exports=t):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return t}):window.classNames=t})()});var E="prompt_pilot",_t=`/${E}/v1`,ue="*:is([id*='_toprow'] [id*='_prompt'], .prompt) textarea",mt=200;var Re;function fe(e){e&&(Re=[],Object.entries(e.loraModels).forEach(([t,n])=>{Re.push({value:t,searchWords:n.search_words,previewFile:n.preview_file})}))}function yt(e){let t=e.toLowerCase().split(/[ _-]/g).filter(o=>o.trim()!==""),n=[];Re.forEach(o=>{let i=new Set;for(let a of o.searchWords){let l=a.replace(/[ _-]/g,"");t.forEach(c=>{l.includes(c)&&i.add(c)})}if(t.length===i.size){let a={...o,matchedWords:[...i].map(l=>({index:0,word:l})),view:null,isPriority:!1,category:"",useCount:0,postCount:0,consequentTagModel:null,isOfficial:!1};n.push(a)}}),n=n.sort((o,i)=>Kn(o,i,e,t));let r=window.opts[`${E}_max_results_grouplora`];return n.filter(()=>r>0?(r-=1,!0):!1)}function Kn(e,t,n,r){if(e.value===n)return-1;if(t.value===n)return 1;if(t.matchedWords.length!==e.matchedWords.length)return t.matchedWords.length-e.matchedWords.length;let o=gt(e,r),i=gt(t,r);return o&&!i?-1:!o&&i?1:e.value<t.value?-1:1}function gt(e,t){for(let n of t)for(let r of e.value.split(/[ _-]/g))if(r.startsWith(n))return!0;return!1}var ve,T,St,Gn,V,xt,Pt,Et,bt,$e,Le,Ue,It,ee={},At=[],Zn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,_e=Array.isArray;function W(e,t){for(var n in t)e[n]=t[n];return e}function Oe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function y(e,t,n){var r,o,i,a={};for(i in t)i=="key"?r=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?ve.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]==null&&(a[i]=e.defaultProps[i]);return pe(e,a,r,o,null)}function pe(e,t,n,r,o){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++St,__i:-1,__u:0};return o==null&&T.vnode!=null&&T.vnode(i),i}function L(e){return e.children}function he(e,t){this.props=e,this.context=t}function K(e,t){if(t==null)return e.__?K(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?K(e):null}function Ct(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Ct(e)}}function Ne(e){(!e.__d&&(e.__d=!0)&&V.push(e)&&!de.__r++||xt!=T.debounceRendering)&&((xt=T.debounceRendering)||Pt)(de)}function de(){for(var e,t,n,r,o,i,a,l=1;V.length;)V.length>l&&V.sort(Et),e=V.shift(),l=V.length,e.__d&&(n=void 0,o=(r=(t=e).__v).__e,i=[],a=[],t.__P&&((n=W({},r)).__v=r.__v+1,T.vnode&&T.vnode(n),Fe(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[o]:null,i,o??K(r),!!(32&r.__u),a),n.__v=r.__v,n.__.__k[n.__i]=n,zt(i,n,a),n.__e!=o&&Ct(n)));de.__r=0}function Mt(e,t,n,r,o,i,a,l,c,f,h){var s,u,p,v,g,_,d=r&&r.__k||At,m=t.length;for(c=Jn(n,t,d,c,m),s=0;s<m;s++)(p=n.__k[s])!=null&&(u=p.__i==-1?ee:d[p.__i]||ee,p.__i=s,_=Fe(e,p,u,o,i,a,l,c,f,h),v=p.__e,p.ref&&u.ref!=p.ref&&(u.ref&&He(u.ref,null,p),h.push(p.ref,p.__c||v,p)),g==null&&v!=null&&(g=v),4&p.__u||u.__k===p.__k?c=Dt(p,c,e):typeof p.type=="function"&&_!==void 0?c=_:v&&(c=v.nextSibling),p.__u&=-7);return n.__e=g,c}function Jn(e,t,n,r,o){var i,a,l,c,f,h=n.length,s=h,u=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(c=i+u,(a=e.__k[i]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?pe(null,a,null,null,null):_e(a)?pe(L,{children:a},null,null,null):a.constructor==null&&a.__b>0?pe(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=e,a.__b=e.__b+1,l=null,(f=a.__i=Yn(a,n,c,s))!=-1&&(s--,(l=n[f])&&(l.__u|=2)),l==null||l.__v==null?(f==-1&&(o>h?u--:o<h&&u++),typeof a.type!="function"&&(a.__u|=4)):f!=c&&(f==c-1?u--:f==c+1?u++:(f>c?u--:u++,a.__u|=4))):e.__k[i]=null;if(s)for(i=0;i<h;i++)(l=n[i])!=null&&!(2&l.__u)&&(l.__e==r&&(r=K(l)),Rt(l,l));return r}function Dt(e,t,n){var r,o;if(typeof e.type=="function"){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=Dt(r[o],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=K(e)),n.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Yn(e,t,n,r){var o,i,a=e.key,l=e.type,c=t[n];if(c===null&&e.key==null||c&&a==c.key&&l==c.type&&!(2&c.__u))return n;if(r>(c!=null&&!(2&c.__u)?1:0))for(o=n-1,i=n+1;o>=0||i<t.length;){if(o>=0){if((c=t[o])&&!(2&c.__u)&&a==c.key&&l==c.type)return o;o--}if(i<t.length){if((c=t[i])&&!(2&c.__u)&&a==c.key&&l==c.type)return i;i++}}return-1}function wt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Zn.test(t)?n:n+"px"}function ce(e,t,n,r,o){var i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||wt(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||wt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(bt,"$1")),t=t.toLowerCase()in e||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r?n.u=r.u:(n.u=$e,e.addEventListener(t,i?Ue:Le,i)):e.removeEventListener(t,i?Ue:Le,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Tt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=$e++;else if(t.t<n.u)return;return n(T.event?T.event(t):t)}}}function Fe(e,t,n,r,o,i,a,l,c,f){var h,s,u,p,v,g,_,d,m,w,A,N,R,Y,B,M,q,S=t.type;if(t.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),i=[l=t.__e=n.__e]),(h=T.__b)&&h(t);e:if(typeof S=="function")try{if(d=t.props,m="prototype"in S&&S.prototype.render,w=(h=S.contextType)&&r[h.__c],A=h?w?w.props.value:h.__:r,n.__c?_=(s=t.__c=n.__c).__=s.__E:(m?t.__c=s=new S(d,A):(t.__c=s=new he(d,A),s.constructor=S,s.render=er),w&&w.sub(s),s.props=d,s.state||(s.state={}),s.context=A,s.__n=r,u=s.__d=!0,s.__h=[],s._sb=[]),m&&s.__s==null&&(s.__s=s.state),m&&S.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=W({},s.__s)),W(s.__s,S.getDerivedStateFromProps(d,s.__s))),p=s.props,v=s.state,s.__v=t,u)m&&S.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),m&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(m&&S.getDerivedStateFromProps==null&&d!==p&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(d,A),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(d,s.__s,A)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(s.props=d,s.state=s.__s,s.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function($){$&&($.__=t)}),N=0;N<s._sb.length;N++)s.__h.push(s._sb[N]);s._sb=[],s.__h.length&&a.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(d,s.__s,A),m&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(p,v,g)})}if(s.context=A,s.props=d,s.__P=e,s.__e=!1,R=T.__r,Y=0,m){for(s.state=s.__s,s.__d=!1,R&&R(t),h=s.render(s.props,s.state,s.context),B=0;B<s._sb.length;B++)s.__h.push(s._sb[B]);s._sb=[]}else do s.__d=!1,R&&R(t),h=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++Y<25);s.state=s.__s,s.getChildContext!=null&&(r=W(W({},r),s.getChildContext())),m&&!u&&s.getSnapshotBeforeUpdate!=null&&(g=s.getSnapshotBeforeUpdate(p,v)),M=h,h!=null&&h.type===L&&h.key==null&&(M=kt(h.props.children)),l=Mt(e,_e(M)?M:[M],t,n,r,o,i,a,l,c,f),s.base=t.__e,t.__u&=-161,s.__h.length&&a.push(s),_&&(s.__E=s.__=null)}catch($){if(t.__v=null,c||i!=null)if($.then){for(t.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else for(q=i.length;q--;)Oe(i[q]);else t.__e=n.__e,t.__k=n.__k;T.__e($,t,n)}else i==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=Qn(n.__e,t,n,r,o,i,a,c,f);return(h=T.diffed)&&h(t),128&t.__u?void 0:l}function zt(e,t,n){for(var r=0;r<n.length;r++)He(n[r],n[++r],n[++r]);T.__c&&T.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){T.__e(i,o.__v)}})}function kt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:_e(e)?e.map(kt):W({},e)}function Qn(e,t,n,r,o,i,a,l,c){var f,h,s,u,p,v,g,_=n.props,d=t.props,m=t.type;if(m=="svg"?o="http://www.w3.org/2000/svg":m=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(f=0;f<i.length;f++)if((p=i[f])&&"setAttribute"in p==!!m&&(m?p.localName==m:p.nodeType==3)){e=p,i[f]=null;break}}if(e==null){if(m==null)return document.createTextNode(d);e=document.createElementNS(o,m,d.is&&d),l&&(T.__m&&T.__m(t,i),l=!1),i=null}if(m==null)_===d||l&&e.data==d||(e.data=d);else{if(i=i&&ve.call(e.childNodes),_=n.props||ee,!l&&i!=null)for(_={},f=0;f<e.attributes.length;f++)_[(p=e.attributes[f]).name]=p.value;for(f in _)if(p=_[f],f!="children"){if(f=="dangerouslySetInnerHTML")s=p;else if(!(f in d)){if(f=="value"&&"defaultValue"in d||f=="checked"&&"defaultChecked"in d)continue;ce(e,f,null,p,o)}}for(f in d)p=d[f],f=="children"?u=p:f=="dangerouslySetInnerHTML"?h=p:f=="value"?v=p:f=="checked"?g=p:l&&typeof p!="function"||_[f]===p||ce(e,f,p,_[f],o);if(h)l||s&&(h.__html==s.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(s&&(e.innerHTML=""),Mt(t.type=="template"?e.content:e,_e(u)?u:[u],t,n,r,m=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:n.__k&&K(n,0),l,c),i!=null)for(f=i.length;f--;)Oe(i[f]);l||(f="value",m=="progress"&&v==null?e.removeAttribute("value"):v!=null&&(v!==e[f]||m=="progress"&&!v||m=="option"&&v!=_[f])&&ce(e,f,v,_[f],o),f="checked",g!=null&&g!=e[f]&&ce(e,f,g,_[f],o))}return e}function He(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(o){T.__e(o,n)}}function Rt(e,t,n){var r,o;if(T.unmount&&T.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||He(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){T.__e(i,t)}r.base=r.__P=null}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&Rt(r[o],t,n||typeof e.type!="function");n||Oe(e.__e),e.__c=e.__=e.__e=void 0}function er(e,t,n){return this.constructor(e,n)}function Wt(e,t,n){var r,o,i,a;t==document&&(t=document.documentElement),T.__&&T.__(e,t),o=(r=typeof n=="function")?null:n&&n.__k||t.__k,i=[],a=[],Fe(t,e=(!r&&n||t).__k=y(L,null,[e]),o||ee,ee,t.namespaceURI,!r&&n?[n]:o?null:t.firstChild?ve.call(t.childNodes):null,i,!r&&n?n:o?o.__e:t.firstChild,r,a),zt(i,e,a)}function Lt(e){function t(n){var r,o;return this.getChildContext||(r=new Set,(o={})[t.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&r.forEach(function(a){a.__e=!0,Ne(a)})},this.sub=function(i){r.add(i);var a=i.componentWillUnmount;i.componentWillUnmount=function(){r&&r.delete(i),a&&a.call(i)}}),n.children}return t.__c="__cC"+It++,t.__=e,t.Provider=t.__l=(t.Consumer=function(n,r){return n.children(r)}).contextType=t,t}ve=At.slice,T={__e:function(e,t,n,r){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,r||{}),a=o.__d),a)return o.__E=o}catch(l){e=l}throw e}},St=0,Gn=function(e){return e!=null&&e.constructor==null},he.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=W({},this.state),typeof e=="function"&&(e=e(W({},n),this.props)),e&&W(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ne(this))},he.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ne(this))},he.prototype.render=L,V=[],Pt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Et=function(e,t){return e.__v.__b-t.__v.__b},de.__r=0,bt=/(PointerCapture)$|Capture$/i,$e=0,Le=Tt(!1),Ue=Tt(!0),It=0;var G,P,Be,Ut,ge=0,Vt=[],b=T,Nt=b.__b,$t=b.__r,Ot=b.diffed,Ft=b.__c,Ht=b.unmount,Bt=b.__;function ye(e,t){b.__h&&b.__h(P,e,ge||t),ge=0;var n=P.__H||(P.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function jt(e,t,n){var r=ye(G++,2);if(r.t=e,!r.__c&&(r.__=[n?n(t):rr(void 0,t),function(l){var c=r.__N?r.__N[0]:r.__[0],f=r.t(c,l);c!==f&&(r.__N=[f,r.__[1]],r.__c.setState({}))}],r.__c=P,!P.__f)){var o=function(l,c,f){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(u){return!!u.__c});if(h.every(function(u){return!u.__N}))return!i||i.call(this,l,c,f);var s=r.__c.props!==l;return h.forEach(function(u){if(u.__N){var p=u.__[0];u.__=u.__N,u.__N=void 0,p!==u.__[0]&&(s=!0)}}),i&&i.call(this,l,c,f)||s};P.__f=!0;var i=P.shouldComponentUpdate,a=P.componentWillUpdate;P.componentWillUpdate=function(l,c,f){if(this.__e){var h=i;i=void 0,o(l,c,f),i=h}a&&a.call(this,l,c,f)},P.shouldComponentUpdate=o}return r.__N||r.__}function F(e,t){var n=ye(G++,3);!b.__s&&Zt(n.__H,t)&&(n.__=e,n.u=t,P.__H.__h.push(n))}function te(e){return ge=5,Xt(function(){return{current:e}},[])}function Xt(e,t){var n=ye(G++,7);return Zt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Kt(e,t){return ge=8,Xt(function(){return e},t)}function Gt(e){var t=P.context[e.__c],n=ye(G++,9);return n.c=e,t?(n.__==null&&(n.__=!0,t.sub(P)),t.props.value):e.__}function tr(){for(var e;e=Vt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(me),e.__H.__h.forEach(qe),e.__H.__h=[]}catch(t){e.__H.__h=[],b.__e(t,e.__v)}}b.__b=function(e){P=null,Nt&&Nt(e)},b.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Bt&&Bt(e,t)},b.__r=function(e){$t&&$t(e),G=0;var t=(P=e.__c).__H;t&&(Be===P?(t.__h=[],P.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(me),t.__h.forEach(qe),t.__h=[],G=0)),Be=P},b.diffed=function(e){Ot&&Ot(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Vt.push(t)!==1&&Ut===b.requestAnimationFrame||((Ut=b.requestAnimationFrame)||nr)(tr)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Be=P=null},b.__c=function(e,t){t.some(function(n){try{n.__h.forEach(me),n.__h=n.__h.filter(function(r){return!r.__||qe(r)})}catch(r){t.some(function(o){o.__h&&(o.__h=[])}),t=[],b.__e(r,n.__v)}}),Ft&&Ft(e,t)},b.unmount=function(e){Ht&&Ht(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{me(r)}catch(o){t=o}}),n.__H=void 0,t&&b.__e(t,n.__v))};var qt=typeof requestAnimationFrame=="function";function nr(e){var t,n=function(){clearTimeout(r),qt&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);qt&&(t=requestAnimationFrame(n))}function me(e){var t=P,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),P=t}function qe(e){var t=P;e.__c=e.__(),P=t}function Zt(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function rr(e,t){return typeof t=="function"?t(e):t}function xe(e,t){e({type:"SET_VISIBILITY",payload:t})}function we(e,t){e({type:"SET_POSITION",payload:t})}function Ve(e,t){e({type:"SET_TEXTAREA",payload:t})}function Jt(e,t){e({type:"SET_TAB",payload:t})}function ne(e,t,n){e({type:"SET_ITEMS",payload:{type:t,items:n}})}function Te(e,t){e({type:"SET_SELECTED_ITEM",payload:t})}function Yt(e,t,n){e({type:"SET_MESSAGE",payload:{type:t,message:n}})}var Qt=()=>{let{state:e}=C();return e.status==="success"&&e.selectedItem&&e.type==="lora"&&y("div",{className:"preview"},y("img",{src:e.selectedItem?e.selectedItem.previewFile??void 0:""}))};var ln=vt(je());function Pe(e,t){let n=null,r=null,o=null,i=!1;return(...a)=>{let l=Date.now();!r||l-r>=t?(e(...a),i=!1):(i=!0,o=a),r=l,n&&clearTimeout(n),n=setTimeout(()=>{i&&o&&e(...o),r=null,i=!1},t)}}function en(e){return Math.abs(e)>=1e12?(e/1e12).toFixed(1)+"T":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"G":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}var k,H,re,oe;function tn(e){e&&(re=new Set,window.opts[`${E}_always_underscore_tags`].split(/[\n,]/).forEach(t=>{t=t.trim().replace(/_/g," "),t&&re.add(t)}),oe=new Set,window.opts[`${E}_always_space_tags`].split(/[\n,]/).forEach(t=>{t=t.trim().replace(/_/g," "),t&&oe.add(t)}),k={},Object.entries(e.tagModels).forEach(([t,n])=>{let r=t.split(/[ _-]/g),o=k[t]??{value:t,values:t.split(/[ _-]/g),flatValue:r.join(""),category:n.category,useCount:n.use_count,postCount:n.post_count,consequentTagModel:void 0,isOfficial:!0};o.isOfficial=!0;for(let i of n.aliases){let a=i.split(/[ _-]/g),l=k[i]??{value:i,values:i.split(/[ _-]/g),flatValue:a.join(""),category:n.category,useCount:n.use_count,postCount:n.post_count,consequentTagModel:o,isOfficial:!1};l.isOfficial?l.consequentTagModel=o:k[i]=l}k[t]=o}),or(k))}function nn(e,t=3){let n=new Set;for(let r of e.split(/[ _-]/g)){let o=Math.min(t,r.length);for(let i=1;i<=o;i++)n.add(r.substring(0,i))}return n}function or(e){H={};for(let t of Object.values(e)){let n=nn(t.value,3);for(let r of n)r in H||(H[r]={}),H[r][t.value]=t}}function ir(e){if(e.value&&e.value in k)return;k[e.value]=e;let t=nn(e.value,3);for(let n of t)n in H||(H[n]={}),H[n][e.value]=e}function rn(e){return k[e]}function on(e,t){let n=e.toLowerCase().split(/[ _-]/g).filter(s=>s.trim()!==""),r;n.length>1&&(r=n.join(""));let o=new Set(t),i=[],a={};n.forEach(s=>{let u=s.length>3?s.slice(0,3):s,p=H[u];for(let v in p){if(v in a)continue;let g=p[v],_=[];if(r&&g.value.startsWith(r))for(let d=0;d<n.length;d++)_.push({word:n[d],index:d});else{let d={};for(let m of n){if(!(0 in d)&&g.flatValue.startsWith(m)){_.push({word:m,index:0}),d[0]=!0;continue}for(let w=0;w<g.values.length;w++)if(!(w in d)&&g.values[w].startsWith(m)){_.push({word:m,index:w}),d[w]=!0;break}}}if(_.length>0){let d={...g,isPriority:o.has(g.value),matchedWords:_,view:null,previewFile:""};i.push(d),a[v]=!0}}});let l=i.filter(s=>!s.consequentTagModel).reduce((s,u)=>(s[u.value]=u.matchedWords.length,s),{});i=i.filter(s=>{if(!s.consequentTagModel)return!0;let u=s.consequentTagModel.value;return!(u in l)||l[u]<s.matchedWords.length});let c={},f={};i.forEach(s=>{s.matchedWords.forEach(u=>{c[u.word]||(c[u.word]=0),c[u.word]+=1})}),i.forEach(s=>{f[s.value]=s.matchedWords.reduce((u,p)=>u+c[p.word],0)}),i=i.sort((s,u)=>sr(s,u,e,r,n,f));let h={};for(let s of["0","1","3","4","5","custom"])h[s]=window.opts[`${E}_max_results_group${s}`];return i.filter(s=>h[s.category]<0||h[s.category]>0?(h[s.category]-=1,!0):!1)}function sr(e,t,n,r,o,i){if(e.isPriority&&!t.isPriority)return-1;if(!e.isPriority&&t.isPriority)return 1;if(e.value===n||r&&e.value===r)return-1;if(t.value===n||r&&t.value===r)return 1;if(t.matchedWords.length!==e.matchedWords.length)return t.matchedWords.length-e.matchedWords.length;if(o.length===e.matchedWords.length){for(let l=0;l<e.matchedWords.length;l++)if(e.matchedWords[l].index!==t.matchedWords[l].index)return e.matchedWords[l].index-t.matchedWords[l].index}if(t.useCount!==e.useCount)return t.useCount-e.useCount;let a=i[e.value]-i[t.value];return a!==0?a:t.postCount!==e.postCount?t.postCount-e.postCount:e.value<t.value?-1:1}var sn=Pe((e,t)=>{let r="https://danbooru.donmai.us/autocomplete.json";r+=`?search[query]=${encodeURIComponent(e)}`,r+="&search[type]=tag",r+="&limit=50",r+="&version=1";let o=[];fetch(r).then(async i=>{if(!i.ok){console.error("Error fetching tag data:",i.statusText),t(o);return}o=(await i.json()).map(l=>{let c,f=null;return l.antecedent?(c=l.antecedent,f=k[l.label]):c=l.label,{value:c,category:l.category.toString(),matchedWords:[],useCount:0,postCount:l.post_count,consequentTagModel:f,isOfficial:f===void 0,isPriority:!1,view:null,previewFile:null}}),o.forEach(l=>{let c=l.value.split(/[ _-]/g);ir({...l,values:c,flatValue:c.join("")})}),t(o)}).catch(i=>{console.error("Error fetching tag data:",i),t(o)})},1100);function Ee(e){let t;if(e.selectedItem&&(t=e.selectedItem),!t)return;let n;if(e.type==="tag")n=ar(e,t);else if(e.type==="lora")n=lr(e,t);else if(e.type==="simple")n=ur(e,t);else return;let r=window.opts[`${E}_using_execCommand`],o=e.textarea;if(r)o.focus(),o.setSelectionRange(n.range.start,n.range.end),document.execCommand("insertText",!1,n.insertText);else{let i=o.value;o.value=i.slice(0,n.range.start)+n.insertText+i.slice(n.range.end)}o.selectionStart=o.selectionEnd=n.range.start+n.insertText.length}function ar(e,t){let{promptInfo:n,insertionInfo:r}=e.parseResult,i=n.words[n.activeWordIndex].position,a=-1,l=[];l.push(t.value),t.consequentTagModel&&l.push(t.consequentTagModel.value);let c=n.prompt.substring(i,n.caretPosition);for(let p of cr(c,/[ _-]/g))for(let v of l){if(p.word==="")continue;let g=Ke(fr(p.word)),_=new RegExp(`(?:^|[ _-])${g}`,"gi").exec(v);_&&_.index!==-1&&(a===-1||a>p.position)&&(a=p.position)}a>-1&&(i+=a);let f=t.isOfficial?t.value:t.consequentTagModel.value,h=window.opts[`${E}_tag_source`].replace(/\./g,"_"),s=window.opts[`${E}_${h}_${t.category}_tag_delimiter`]??"auto";if(!oe.has(f)){let p=!1;re.has(f)||s==="underscore"?p=!0:s==="auto"&&(p=n.inputtingString.includes("_")),p&&(f=f.replace(/ /g,"_"))}return r.needPrependComma?f=", "+f:a<=0&&r.needPrependSpace&&(f=" "+f),f=an(f),window.opts[`${E}_append_comma`]&&(f+=","),f+=" ",{range:{start:i,end:n.caretPosition},insertText:f}}function lr(e,t){let{promptInfo:n}=e.parseResult,o=n.words[n.activeWordIndex].position,i=t.value,a=n.prompt.substring(o).match(/^<(?:lora|lyco):[^<>:]+(:.+>)/i),l=n.caretPosition;return a?(l=o+a[0].length,i+=a[1]):i+=":1>",i+=" ",{range:{start:o,end:l},insertText:i}}function ur(e,t){let{promptInfo:n,insertionInfo:r}=e.parseResult,i=n.words[n.activeWordIndex].position,l=rn(t.value)?.category??"custom",c=an(t.value),f=window.opts[`${E}_tag_source`].replace(/\./g,"_"),h=window.opts[`${E}_${f}_${l}_tag_delimiter`]??"auto";if(!oe.has(c)){let u=!1;re.has(c)||h==="underscore"?u=!0:h==="auto"&&(u=n.inputtingString.includes("_")),u&&(c=c.replace(/ /g,"_"))}return r.needPrependComma?c=", "+c:r.needPrependSpace&&(c=" "+c),window.opts[`${E}_append_comma`]&&(c+=","),c+=" ",{range:{start:i,end:n.caretPosition},insertText:c}}function Ke(e){return e.replace(/[.*+?^${}()|\[\]\\]/g,"\\$&")}function an(e){return e.replace(/[{}()\[\]\\]/g,"\\$&")}function fr(e){let t="";for(let n=0;n<e.length;n++)e[n]==="\\"?n+1<e.length?(t+=e[n+1],n++):t+="\\":t+=e[n];return t}function cr(e,t){let n=[],r=t,o,i=0;for(;(o=r.exec(e))!==null;)n.push({word:e.slice(i,o.index),position:i}),i=r.lastIndex;return n.push({word:e.slice(i),position:i}),n}var ie=e=>{if(e){e=e.replace(" ","_"),/^[0-9]+$/.test(e)&&(e=`~${e}`);let t=window.opts[`${E}_tag_source`];window.open(`https://${t}/wiki_pages/${encodeURIComponent(e)}`)}};var un=()=>{let{state:e,dispatch:t}=C();F(()=>{if(e.selectedItem){let a=document.querySelector("#suggestion-box li.selected");a&&a.scrollIntoView({block:"nearest"})}},[e.selectedItem]);let n=e.items.filter(a=>e.selectedCategory==="all"||String(a.category)===e.selectedCategory),r=a=>{let c=a.target.closest("li");if(c){let f=n[+c.dataset.index];f&&(e.selectedItem===null||e.selectedItem.value!==f.value)&&Te(t,f)}},o=a=>{let l=a.target,c=l.closest("li");if(c){a.stopPropagation();let f=n[+c.dataset.index];if(Ee(e),l instanceof HTMLAnchorElement){let h=f.isOfficial?f.value:f.consequentTagModel.value;ie(h)}xe(t,!1)}},i;return e.status==="loading"?i="Loading models...":e.status==="error"?i="An error occurred. Please reload the page.":e.message&&(i=e.message),y("ul",{key:`${e.selectedCategory}_${i}_${n.length}`,class:"list-container",onMouseMove:a=>r(a),onMouseDown:a=>o(a)},i&&y("li",{key:i,className:"notice","data-type":""},i),!i&&n.map((a,l)=>y("li",{key:a.value,className:(0,ln.default)(`group${a.category}`,e.selectedItem&&e.selectedItem.value===a.value?"selected":""),"data-index":l},e.type==="tag"&&y("span",{className:"highlight recommend"}),e.type==="tag"&&y("a",{className:"wiki"},"?"),y("span",{className:"title"},y(pr,{item:a})),e.type==="tag"&&a.postCount>0&&y("span",{className:"post-count"},en(a.postCount)))))},pr=({item:e})=>{let t=n=>{let r=[n];return e.matchedWords.forEach((o,i)=>{let a=Ke(o.word),l=new RegExp(`(${a})`,"gi"),c=[];r.forEach((f,h)=>{typeof f=="string"?f.split(l).forEach((u,p)=>{p%2===1?c.push(y("b",{key:`${i}-${h}-${p}`},u)):u&&c.push(u)}):c.push(f)}),r=c}),r};return y(L,null,t(e.value),e.consequentTagModel&&y(L,null,y("span",null),t(e.consequentTagModel.value)))};var Ge=vt(je());var fn=()=>{let{state:e,dispatch:t}=C(),n=o=>{Jt(t,o)},r=[["all","ALL"],["0","Gen"],["1","Art"],["3","Copy"],["4","Chara"],["5","Meta"]];return y("div",{className:(0,Ge.default)("tab-container",e.status==="success"&&e.type==="tag"?"":"no-tab")},r.map(([o,i])=>y("div",{key:o,className:(0,Ge.default)("tab",`group${o}`,e.selectedCategory===o?"selected":""),onClick:()=>n(o)},i)))};function cn(e){if(!e.isVisible||!e.textarea)return!1;let{promptInfo:t,insertionInfo:n}=e.parseResult;return!(n.isMetaBlock||t.activeWordIndex>=0&&t.words[t.activeWordIndex].type==="lora"&&t.inputtingString===""||!window.opts[`${E}_suggest_enabled`]&&t.inputtingString==="")}function be(e){let t=e.textarea;if(!t)return{offset_x:0,offset_y:0,x:0,y:0};let n=t.dummy,r=n.caret,o=t.selectionEnd,i=t.value.slice(0,o),a=t.value.slice(o);n.textContent=i,r.textContent=a[0]||"\u200B",n.appendChild(r);let l=r.getBoundingClientRect(),c=window.getComputedStyle(t),f=parseFloat(c.lineHeight.replace(/[^\d\.]+/,"")),h=t.getBoundingClientRect(),s=l.left-h.left-t.scrollLeft,u=l.top-h.top-t.scrollTop+f;return{offset_y:h.top+window.scrollY,offset_x:h.left+window.scrollX,x:s,y:u}}var pn=({offset_x:e,offset_y:t,x:n,y:r})=>({top:`${t}px`,left:`${e}px`,transform:`translate(${n}px, ${r}px)`}),hn=e=>cn(e)?{}:{display:"none"};var dn={"(":"paren","[":"square","{":"curly","<":"lora"},hr={")":"paren","]":"square","}":"curly",">":"lora"},dr={root:"",paren:")",square:"]",curly:"}",lora:">"},vr={root:new Set([","]),paren:new Set([","]),square:new Set([",",":","|"]),curly:new Set([",","|"]),lora:new Set},_r=new Set([",","|",":","(","[","{","<"]),Ie=5,mr=["BREAK","AND","ADDCOMM","ADDBASE","ADDCOL","ADDROW"],gr=/\{([\d-]+\$\$(?:[^\}]+?\$\$)?)(.*)\}/g,yr=new RegExp(`\\b(${mr.join("|")})\\b`,"g");function Z(e,t){return{value:"",position:t,type:e==="lora"?"lora":"tag",isActive:!1}}function Ae(e,t){let n={prompt:e,caretPosition:t,inputtingString:"",activeWordIndex:-1,words:[]},r={isMetaBlock:!1,needPrependComma:!1,needPrependSpace:!1};e=e.replace(yr,p=>",".padEnd(p.length,"\0")),e=e.replace(gr,(p,v,g)=>`{${"\0".repeat(v.length)}${g}}`);let o=["root"],i=!1,a,l=!0;function c(p){p.value=p.value.trim(),(p.isActive||p.value!=="")&&(n.words.push(p),l=!1,a=void 0)}function f(p){p===`
`?l=!0:_r.has(p)&&(a=p)}function h(p){p.isActive&&n.words.length>0&&(a===void 0?(r.needPrependComma=!0,l||(r.needPrependSpace=!0)):a===","&&(r.needPrependSpace=!0))}function s(p){p.isActive=!0;let v=n.inputtingString;i&&(v+="\\",n.inputtingString=v),n.inputtingString=p.value.trim(),n.activeWordIndex=n.words.length}let u=Z("root",0);for(let p=0;p<e.length;p++){let v=e[p];p===t&&s(u);let g=o[o.length-1];if(v==="\0"){u.isActive&&(r.isMetaBlock=!0,r.needPrependSpace=!0),u.position++;continue}if(v===`
`){h(u),c(u),f(v),u=Z(g,p+1),i=!1;continue}if(i){u.value+=v,i=!1;continue}if(v==="\\"){i=!0;continue}if(v in dn){let _=dn[v];if(_==="lora"&&(_="root",e.length-p>Ie)){let d=e.substring(p+1,p+Ie+1);(d==="lora:"||d==="lyco:")&&(_="lora")}if(_!=="root"){o.push(_),_==="lora"&&(p+=Ie,p-t>=0&&p-t<Ie&&(r.isMetaBlock=!0)),h(u),c(u),f(v),_==="lora"?u=Z(_,p+1):u=Z(_,p);continue}}if(v in hr){let _=dr[g];if(v!==_){u.value+=v;continue}if(g==="paren"||g==="square"){let d=u.value.lastIndexOf(":");if(d>=0){let m=u.value.substring(0,d),w=u.value.substring(d+1);vn(w)&&(u.value=m,u.isActive&&p-t<=w.length&&(r.isMetaBlock=!0))}else g==="square"&&vn(u.value)&&(u.isActive&&p-t<=u.value.length&&(r.isMetaBlock=!0),u.value="")}else if(g==="lora"){let d=u.value.indexOf(":");if(d>=0){let m=u.value.substring(0,d),w=u.value.substring(d+1);u.isActive&&p-t<=w.length&&(r.isMetaBlock=!0),u.value=m}}o.pop(),h(u),c(u),f(v),u=Z(o[o.length-1],p+1);continue}if(g==="lora"){(u.value!==""||v!==" ")&&(u.value+=v);continue}if(vr[g]?.has(v)){h(u),c(u),f(v),u=Z(g,p+1);continue}u.value===""&&(u.position=p),u.value+=v}return n.activeWordIndex<0&&s(u),n.words.forEach(p=>{p.value=p.value.replace(/_/g," ")}),h(u),c(u),{promptInfo:n,insertionInfo:r}}function vn(e){return e.trim()===""?!1:!isNaN(+e)}function Ze(e,t,n=[]){let{state:r}=C();F(()=>{if(!window.pilotIsActive||!r.textarea)return;let o=t;return r.textarea.addEventListener(e,o),()=>{r.textarea?.removeEventListener(e,o)}},[r.textarea,e,t,...n])}var Je=(e,t,n=[])=>Ze(e,t,n),Ce=(e,t,n=[])=>Ze(e,t,n),Ye=(e,t,n=[])=>Ze(e,t,n);var Qe;function mn(e){e&&(Qe={},Object.entries(e.suggestionModels).forEach(([t,n])=>{let r=Object.entries(n).sort(([,o],[,i])=>i-o);Qe[t]=r.map(([o,i])=>({value:o,count:i}))}))}function et(e,t){if(!e)return[];let n=Qe[e];if(!n)return[];let r=[];for(let o of n)t.has(o.value)||r.push({...o,view:null,isPriority:!1,matchedWords:[],category:"",useCount:0,postCount:0,consequentTagModel:null,isOfficial:!1,previewFile:null});return r}function xr(e){let t=e.textarea;return Ae(t.value,t.selectionEnd)}function wr(e){return new Set(e.words.filter((t,n)=>n!==e.activeWordIndex&&t.type!=="lora").map(t=>t.value))}function Tr(e){for(let t=e.activeWordIndex-1;t>=0;t--){let n=e.words[t];if(n.type!=="lora")return n.value}}function Sr(e,t,n){let r=et(t,n),o=[];for(let i of r)i.value.startsWith(e)&&o.push(i.value);return o}function Pr(e,t,n,r){if(e===""){let i=et(t,n);ne(r,"simple",i);return}let o=Sr(e,t,n);if(e.startsWith("*")&&e.length>1)sn(e.substring(1),i=>{ne(r,"tag",i)}),Yt(r,"tag","Searching for tags via API...");else{let i=on(e,o);ne(r,"tag",i)}}function Er(e,t){let n=yt(e);ne(t,"lora",n)}function yn(e,t){let n=xr(e);if(e.status!=="success"){t({type:"SET_VISIBILITY",payload:!0});return}t({type:"SET_PARSE_RESULT",payload:n});let{promptInfo:r}=n,o=r.words[r.activeWordIndex],i=r.inputtingString,a=wr(r);if(o.type!=="lora"){let l=Tr(r);Pr(i,l,a,t)}else Er(i,t)}var tt=Pe(yn,mt),nt,xn=()=>{let{state:e,dispatch:t}=C(),n=te(!1),r=te(!1);return Je("mousedown",o=>{o.ctrlKey&&setTimeout(()=>{nt=new Promise(i=>{let a=e.textarea,l=Ae(a.value,a.selectionEnd);t({type:"SET_PARSE_RESULT",payload:l});let{promptInfo:c}=l,f=c.words[c.activeWordIndex];i(f)})},50)},[e.textarea]),Je("mouseup",o=>{o.ctrlKey&&nt&&nt.then(i=>{i.type==="tag"&&ie(i.value)})},[e.textarea]),Ye("compositionstart",()=>{console.debug("compositionstart"),r.current=!0},[e.textarea]),Ye("compositionend",()=>{console.debug("compositionend"),r.current=!1,n.current||(we(t,be(e)),tt(e,t))},[e.textarea]),Ce("input",()=>{console.debug("input"),!(n.current||r.current)&&(we(t,be(e)),tt(e,t))},[e.textarea,e.isVisible,e.status]),Ce("keydown",o=>{console.debug("keydown");let i=o.key;if(o.ctrlKey&&(i==="ArrowDown"||i==="ArrowUp")){n.current=!0;return}if(e.isVisible&&!r.current){if(i==="Escape"){xe(t,!1),o.preventDefault(),o.stopPropagation();return}if(e.items.length){if(i==="Tab"){let a=e.selectedItem;if(a&&(Ee(e),o.shiftKey&&e.type==="tag")){let l=a;if(l.isOfficial!==void 0){let c=l.isOfficial?l.value:l.consequentTagModel.value;ie(c)}}o.preventDefault()}else if((i==="ArrowDown"||i==="ArrowUp")&&!o.ctrlKey&&!o.shiftKey){let a=i==="ArrowDown"?1:-1,l=e.items.filter(h=>e.selectedCategory==="all"||String(h.category)===e.selectedCategory),c=-1;e.selectedItem&&(c=l.findIndex(h=>h.value===e.selectedItem.value));let f=(c+a+l.length)%l.length;Te(t,l[f]),o.preventDefault()}}}},[e.textarea,e.isVisible,e.items,e.selectedItem,e.selectedCategory,e.parseResult]),Ce("keyup",o=>{if(console.debug("keyup"),n.current=!1,!e.isVisible||r.current)return;let i=o.key;["ArrowLeft","ArrowRight","Home","End"].includes(i)&&(we(t,be(e)),tt(e,t),o.preventDefault())},[e.textarea,e.isVisible]),null};var I=Uint8Array,J=Uint16Array,br=Int32Array,wn=new I([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tn=new I([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ir=new I([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sn=function(e,t){for(var n=new J(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var o=new br(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return{b:n,r:o}},Pn=Sn(wn,2),En=Pn.b,Ar=Pn.r;En[28]=258,Ar[258]=28;var bn=Sn(Tn,0),Cr=bn.b,Oo=bn.r,it=new J(32768);for(x=0;x<32768;++x)U=(x&43690)>>1|(x&21845)<<1,U=(U&52428)>>2|(U&13107)<<2,U=(U&61680)>>4|(U&3855)<<4,it[x]=((U&65280)>>8|(U&255)<<8)>>1;var U,x,se=function(e,t,n){for(var r=e.length,o=0,i=new J(t);o<r;++o)e[o]&&++i[e[o]-1];var a=new J(t);for(o=1;o<t;++o)a[o]=a[o-1]+i[o-1]<<1;var l;if(n){l=new J(1<<t);var c=15-t;for(o=0;o<r;++o)if(e[o])for(var f=o<<4|e[o],h=t-e[o],s=a[e[o]-1]++<<h,u=s|(1<<h)-1;s<=u;++s)l[it[s]>>c]=f}else for(l=new J(r),o=0;o<r;++o)e[o]&&(l[o]=it[a[e[o]-1]++]>>15-e[o]);return l},ae=new I(288);for(x=0;x<144;++x)ae[x]=8;var x;for(x=144;x<256;++x)ae[x]=9;var x;for(x=256;x<280;++x)ae[x]=7;var x;for(x=280;x<288;++x)ae[x]=8;var x,In=new I(32);for(x=0;x<32;++x)In[x]=5;var x;var Mr=se(ae,9,1);var Dr=se(In,5,1),rt=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},D=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},ot=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},zr=function(e){return(e+7)/8|0},kr=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new I(e.subarray(t,n))};var Rr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],z=function(e,t,n){var r=new Error(t||Rr[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,z),!n)throw r;return r},Wr=function(e,t,n,r){var o=e.length,i=r?r.length:0;if(!o||t.f&&!t.l)return n||new I(0);var a=!n,l=a||t.i!=2,c=t.i;a&&(n=new I(o*3));var f=function(ct){var pt=n.length;if(ct>pt){var ht=new I(Math.max(pt*2,ct));ht.set(n),n=ht}},h=t.f||0,s=t.p||0,u=t.b||0,p=t.l,v=t.d,g=t.m,_=t.n,d=o*8;do{if(!p){h=D(e,s,1);var m=D(e,s+1,3);if(s+=3,m)if(m==1)p=Mr,v=Dr,g=9,_=5;else if(m==2){var R=D(e,s,31)+257,Y=D(e,s+10,15)+4,B=R+D(e,s+5,31)+1;s+=14;for(var M=new I(B),q=new I(19),S=0;S<Y;++S)q[Ir[S]]=D(e,s+S*3,7);s+=Y*3;for(var $=rt(q),Ln=(1<<$)-1,Un=se(q,$,1),S=0;S<B;){var st=Un[D(e,s,Ln)];s+=st&15;var w=st>>4;if(w<16)M[S++]=w;else{var j=0,le=0;for(w==16?(le=3+D(e,s,3),s+=2,j=M[S-1]):w==17?(le=3+D(e,s,7),s+=3):w==18&&(le=11+D(e,s,127),s+=7);le--;)M[S++]=j}}var at=M.subarray(0,R),O=M.subarray(R);g=rt(at),_=rt(O),p=se(at,g,1),v=se(O,_,1)}else z(1);else{var w=zr(s)+4,A=e[w-4]|e[w-3]<<8,N=w+A;if(N>o){c&&z(0);break}l&&f(u+A),n.set(e.subarray(w,N),u),t.b=u+=A,t.p=s=N*8,t.f=h;continue}if(s>d){c&&z(0);break}}l&&f(u+131072);for(var Nn=(1<<g)-1,$n=(1<<_)-1,De=s;;De=s){var j=p[ot(e,s)&Nn],X=j>>4;if(s+=j&15,s>d){c&&z(0);break}if(j||z(2),X<256)n[u++]=X;else if(X==256){De=s,p=null;break}else{var lt=X-254;if(X>264){var S=X-257,Q=wn[S];lt=D(e,s,(1<<Q)-1)+En[S],s+=Q}var ze=v[ot(e,s)&$n],ke=ze>>4;ze||z(3),s+=ze&15;var O=Cr[ke];if(ke>3){var Q=Tn[ke];O+=ot(e,s)&(1<<Q)-1,s+=Q}if(s>d){c&&z(0);break}l&&f(u+131072);var ut=u+lt;if(u<O){var ft=i-O,On=Math.min(O,ut);for(ft+u<0&&z(3);u<On;++u)n[u]=r[ft+u]}for(;u<ut;++u)n[u]=n[u-O]}}t.l=p,t.p=De,t.b=u,t.f=h,p&&(h=1,t.m=g,t.d=v,t.n=_)}while(!h);return u!=n.length&&a?kr(n,0,u):n.subarray(0,u)};var Lr=new I(0);var Ur=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&z(6,"invalid gzip data");var t=e[3],n=10;t&4&&(n+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(t&2)},Nr=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0};function An(e,t){var n=Ur(e);return n+8>e.length&&z(6,"invalid gzip data"),Wr(e.subarray(n,-8),{i:2},t&&t.out||new I(Nr(e)),t&&t.dictionary)}var $r=typeof TextDecoder<"u"&&new TextDecoder,Or=0;try{$r.decode(Lr,{stream:!0}),Or=1}catch{}var Cn=async()=>{try{let e=await fetch("file=extensions/sd-webui-prompt-pilot/models.json.gz");if(!e.ok)return{success:!1};let t=new Uint8Array(await e.arrayBuffer()),n=An(t),r=new TextDecoder("utf-8").decode(n);return{success:!0,data:JSON.parse(r)}}catch(e){return console.error(e),{success:!1}}},Mn=e=>{tn(e),fe(e),mn(e)};var Me,Fr=new Promise(e=>{Me=e});onOptionsChanged(()=>{window.pilotIsActive=window.opts[`${E}_enabled`],Me&&(Me(!0),Me=null)});var Dn=e=>{F(()=>{(async()=>{let n=await Cn();if(n.success)try{await Fr,Mn(n.data),e({type:"SET_STATUS",payload:"success"})}catch(r){console.error(r),e({type:"SET_STATUS",payload:"error"})}})()},[e])};var zn=()=>{let{state:e,dispatch:t}=C(),n=te(null);Dn(t);let r=Kt(o=>{let i=o.target;if(i.closest("#suggestion-box")){o.stopPropagation();return}i.matches(ue)?Ve(t,i):Ve(t,null),o.stopPropagation()},[t]);return F(()=>(document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)),[r]),y(L,null,y(xn,null),y("div",{id:"suggestion-box",ref:n,style:{...pn(e.pos),...hn(e)}},y(fn,null),y(un,null),y(Qt,null)))};var kn=(e,t)=>t.type==="SET_TEXTAREA"?(console.debug(t.type),{...e,isVisible:!1,textarea:t.payload,selectedCategory:"all"}):t.type==="SET_VISIBILITY"?(console.debug(t.type),{...e,isVisible:t.payload,selectedCategory:"all"}):t.type==="SET_STATUS"?(console.debug(t.type,t.payload),{...e,status:t.payload}):t.type==="SET_POSITION"?(console.debug(t.type),{...e,pos:{offset_x:t.payload.offset_x,offset_y:t.payload.offset_y,x:t.payload.x,y:t.payload.y}}):t.type==="SET_TAB"?(console.debug(t.type),{...e,selectedCategory:t.payload}):t.type==="SET_SELECTED_ITEM"?(console.debug(t.type),{...e,selectedItem:t.payload}):t.type==="SET_ITEMS"?(console.debug(t.type),{...e,isVisible:!0,type:t.payload.type,items:t.payload.items,selectedItem:t.payload.items.length>0?t.payload.items[0]:null,message:t.payload.items.length>0?"":"No results found"}):t.type==="SET_MESSAGE"?(console.debug(t.type),{...e,isVisible:!0,type:t.payload.type,message:t.payload.message}):t.type==="SET_PARSE_RESULT"?(console.debug(t.type),{...e,parseResult:t.payload}):e;var Rn=Lt(null),C=()=>{let e=Gt(Rn);if(!e)throw new Error("usePromptPilot must be used within a PromptPilotProvider");return e},Hr=({promptPilotState:e,children:t})=>{let[n,r]=jt(kn,e);return y(Rn.Provider,{value:{state:n,dispatch:r}},t)};function Wn(e){Wt(y(Hr,{promptPilotState:e},y(zn,null)),document.getElementById("prompt-pilot-container"))}window.pilotIsActive=!0;onUiLoaded(()=>{let e=gradioApp().querySelectorAll(ue),t=getComputedStyle(e[0]),n="",r=new Set(["width","height","inline-size","block-size","resize"]);for(let c=0;c<t.length;c++){let f=t[c];if(!r.has(f)){let h=t.getPropertyValue(f);n+=`${f}: ${h};`}}e.forEach(c=>{let f=c,h=document.createElement("div");h.className="prompt_pilot-dummy",f.parentNode?.insertBefore(h,f.nextSibling),f.dummy=h;let s=document.createElement("span");h.caret=s});let o=new CSSStyleSheet;o.replaceSync(`.prompt_pilot-dummy {${n}}`),document.adoptedStyleSheets=[...document.adoptedStyleSheets,o];let i=document.createElement("div");i.id="prompt-pilot-container",gradioApp().appendChild(i),Wn({isVisible:!1,status:"loading",type:"tag",textarea:null,selectedCategory:"all",selectedItem:null,items:[],pos:{offset_x:0,offset_y:0,x:0,y:0},parseResult:{promptInfo:{prompt:"",caretPosition:0,inputtingString:"",activeWordIndex:-1,words:[]},insertionInfo:{isMetaBlock:!1,needPrependComma:!1,needPrependSpace:!1}},message:""}),gradioApp().querySelectorAll(".extra-network-control--refresh").forEach(c=>{c.addEventListener("click",()=>{fetch(`${_t}/refresh`,{method:"POST"}).then(async f=>{let h=await f.json();fe(h)})})})});})();
/*! Bundled license information:

classnames/index.js:
  (*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  *)
*/
//# sourceMappingURL=prompt_pilot.js.map
