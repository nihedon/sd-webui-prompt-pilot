"use strict";(()=>{var Or=Object.create;var vt=Object.defineProperty;var Fr=Object.getOwnPropertyDescriptor;var Hr=Object.getOwnPropertyNames;var Br=Object.getPrototypeOf,qr=Object.prototype.hasOwnProperty;var Vr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var jr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Hr(t))!qr.call(e,o)&&o!==r&&vt(e,o,{get:()=>t[o],enumerable:!(n=Fr(t,o))||n.enumerable});return e};var _t=(e,t,r)=>(r=e!=null?Or(Br(e)):{},jr(t||!e||!e.__esModule?vt(r,"default",{value:e,enumerable:!0}):r,e));var je=Vr((Qn,Se)=>{(function(){"use strict";var e={}.hasOwnProperty;function t(){for(var o="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(o=n(o,r(a)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var i="";for(var a in o)e.call(o,a)&&o[a]&&(i=n(i,a));return i}function n(o,i){return i?o?o+" "+i:o+i:o}typeof Se<"u"&&Se.exports?(t.default=t,Se.exports=t):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return t}):window.classNames=t})()});var E="prompt_pilot",mt=`/${E}/v1`,ue="*:is([id*='_toprow'] [id*='_prompt'], .prompt) textarea",gt=200;var We;function fe(e){e&&(We=[],Object.entries(e.loraModels).forEach(([t,r])=>{We.push({value:t,searchWords:r.search_words,previewFile:r.preview_file})}))}function xt(e){let t=e.toLowerCase().split(/[ _-]/g).filter(o=>o.trim()!==""),r=[];We.forEach(o=>{let i=new Set;for(let a of o.searchWords){let l=a.replace(/[ _-]/g,"");t.forEach(c=>{l.includes(c)&&i.add(c)})}if(t.length===i.size){let a={...o,matchedWords:[...i].map(l=>({index:0,word:l})),view:null,isPriority:!1,category:"",useCount:0,postCount:0,consequentTagModel:null,isOfficial:!1};r.push(a)}}),r=r.sort((o,i)=>Xr(o,i,e,t));let n=window.opts[`${E}_max_results_grouplora`];return r.filter(()=>n>0?(n-=1,!0):!1)}function Xr(e,t,r,n){if(e.value===r)return-1;if(t.value===r)return 1;if(t.matchedWords.length!==e.matchedWords.length)return t.matchedWords.length-e.matchedWords.length;let o=yt(e,n),i=yt(t,n);return o&&!i?-1:!o&&i?1:e.value<t.value?-1:1}function yt(e,t){for(let r of t)for(let n of e.value.split(/[ _-]/g))if(n.startsWith(r))return!0;return!1}var ve,T,Pt,Kr,V,wt,Et,It,bt,$e,Le,Ue,At,ee={},Ct=[],Gr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,_e=Array.isArray;function k(e,t){for(var r in t)e[r]=t[r];return e}function Oe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function y(e,t,r){var n,o,i,a={};for(i in t)i=="key"?n=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?ve.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]==null&&(a[i]=e.defaultProps[i]);return pe(e,a,n,o,null)}function pe(e,t,r,n,o){var i={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++Pt,__i:-1,__u:0};return o==null&&T.vnode!=null&&T.vnode(i),i}function L(e){return e.children}function he(e,t){this.props=e,this.context=t}function K(e,t){if(t==null)return e.__?K(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?K(e):null}function Mt(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return Mt(e)}}function Ne(e){(!e.__d&&(e.__d=!0)&&V.push(e)&&!de.__r++||wt!=T.debounceRendering)&&((wt=T.debounceRendering)||Et)(de)}function de(){for(var e,t,r,n,o,i,a,l=1;V.length;)V.length>l&&V.sort(It),e=V.shift(),l=V.length,e.__d&&(r=void 0,o=(n=(t=e).__v).__e,i=[],a=[],t.__P&&((r=k({},n)).__v=n.__v+1,T.vnode&&T.vnode(r),Fe(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[o]:null,i,o??K(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,Rt(i,r,a),r.__e!=o&&Mt(r)));de.__r=0}function Dt(e,t,r,n,o,i,a,l,c,f,h){var s,u,p,v,g,_,d=n&&n.__k||Ct,m=t.length;for(c=Zr(r,t,d,c,m),s=0;s<m;s++)(p=r.__k[s])!=null&&(u=p.__i==-1?ee:d[p.__i]||ee,p.__i=s,_=Fe(e,p,u,o,i,a,l,c,f,h),v=p.__e,p.ref&&u.ref!=p.ref&&(u.ref&&He(u.ref,null,p),h.push(p.ref,p.__c||v,p)),g==null&&v!=null&&(g=v),4&p.__u||u.__k===p.__k?c=zt(p,c,e):typeof p.type=="function"&&_!==void 0?c=_:v&&(c=v.nextSibling),p.__u&=-7);return r.__e=g,c}function Zr(e,t,r,n,o){var i,a,l,c,f,h=r.length,s=h,u=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(c=i+u,(a=e.__k[i]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?pe(null,a,null,null,null):_e(a)?pe(L,{children:a},null,null,null):a.constructor==null&&a.__b>0?pe(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=e,a.__b=e.__b+1,l=null,(f=a.__i=Jr(a,r,c,s))!=-1&&(s--,(l=r[f])&&(l.__u|=2)),l==null||l.__v==null?(f==-1&&(o>h?u--:o<h&&u++),typeof a.type!="function"&&(a.__u|=4)):f!=c&&(f==c-1?u--:f==c+1?u++:(f>c?u--:u++,a.__u|=4))):e.__k[i]=null;if(s)for(i=0;i<h;i++)(l=r[i])!=null&&!(2&l.__u)&&(l.__e==n&&(n=K(l)),kt(l,l));return n}function zt(e,t,r){var n,o;if(typeof e.type=="function"){for(n=e.__k,o=0;n&&o<n.length;o++)n[o]&&(n[o].__=e,t=zt(n[o],t,r));return t}e.__e!=t&&(t&&e.type&&!r.contains(t)&&(t=K(e)),r.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Jr(e,t,r,n){var o,i,a=e.key,l=e.type,c=t[r];if(c===null&&e.key==null||c&&a==c.key&&l==c.type&&!(2&c.__u))return r;if(n>(c!=null&&!(2&c.__u)?1:0))for(o=r-1,i=r+1;o>=0||i<t.length;){if(o>=0){if((c=t[o])&&!(2&c.__u)&&a==c.key&&l==c.type)return o;o--}if(i<t.length){if((c=t[i])&&!(2&c.__u)&&a==c.key&&l==c.type)return i;i++}}return-1}function Tt(e,t,r){t[0]=="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||Gr.test(t)?r:r+"px"}function ce(e,t,r,n,o){var i;e:if(t=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||Tt(e.style,t,"");if(r)for(t in r)n&&r[t]==n[t]||Tt(e.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(bt,"$1")),t=t.toLowerCase()in e||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=r,r?n?r.u=n.u:(r.u=$e,e.addEventListener(t,i?Ue:Le,i)):e.removeEventListener(t,i?Ue:Le,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function St(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=$e++;else if(t.t<r.u)return;return r(T.event?T.event(t):t)}}}function Fe(e,t,r,n,o,i,a,l,c,f){var h,s,u,p,v,g,_,d,m,w,A,N,W,Y,B,M,q,S=t.type;if(t.constructor!=null)return null;128&r.__u&&(c=!!(32&r.__u),i=[l=t.__e=r.__e]),(h=T.__b)&&h(t);e:if(typeof S=="function")try{if(d=t.props,m="prototype"in S&&S.prototype.render,w=(h=S.contextType)&&n[h.__c],A=h?w?w.props.value:h.__:n,r.__c?_=(s=t.__c=r.__c).__=s.__E:(m?t.__c=s=new S(d,A):(t.__c=s=new he(d,A),s.constructor=S,s.render=Qr),w&&w.sub(s),s.props=d,s.state||(s.state={}),s.context=A,s.__n=n,u=s.__d=!0,s.__h=[],s._sb=[]),m&&s.__s==null&&(s.__s=s.state),m&&S.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=k({},s.__s)),k(s.__s,S.getDerivedStateFromProps(d,s.__s))),p=s.props,v=s.state,s.__v=t,u)m&&S.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),m&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(m&&S.getDerivedStateFromProps==null&&d!==p&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(d,A),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(d,s.__s,A)===!1||t.__v==r.__v){for(t.__v!=r.__v&&(s.props=d,s.state=s.__s,s.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function($){$&&($.__=t)}),N=0;N<s._sb.length;N++)s.__h.push(s._sb[N]);s._sb=[],s.__h.length&&a.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(d,s.__s,A),m&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(p,v,g)})}if(s.context=A,s.props=d,s.__P=e,s.__e=!1,W=T.__r,Y=0,m){for(s.state=s.__s,s.__d=!1,W&&W(t),h=s.render(s.props,s.state,s.context),B=0;B<s._sb.length;B++)s.__h.push(s._sb[B]);s._sb=[]}else do s.__d=!1,W&&W(t),h=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++Y<25);s.state=s.__s,s.getChildContext!=null&&(n=k(k({},n),s.getChildContext())),m&&!u&&s.getSnapshotBeforeUpdate!=null&&(g=s.getSnapshotBeforeUpdate(p,v)),M=h,h!=null&&h.type===L&&h.key==null&&(M=Wt(h.props.children)),l=Dt(e,_e(M)?M:[M],t,r,n,o,i,a,l,c,f),s.base=t.__e,t.__u&=-161,s.__h.length&&a.push(s),_&&(s.__E=s.__=null)}catch($){if(t.__v=null,c||i!=null)if($.then){for(t.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else for(q=i.length;q--;)Oe(i[q]);else t.__e=r.__e,t.__k=r.__k;T.__e($,t,r)}else i==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):l=t.__e=Yr(r.__e,t,r,n,o,i,a,c,f);return(h=T.diffed)&&h(t),128&t.__u?void 0:l}function Rt(e,t,r){for(var n=0;n<r.length;n++)He(r[n],r[++n],r[++n]);T.__c&&T.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){T.__e(i,o.__v)}})}function Wt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:_e(e)?e.map(Wt):k({},e)}function Yr(e,t,r,n,o,i,a,l,c){var f,h,s,u,p,v,g,_=r.props,d=t.props,m=t.type;if(m=="svg"?o="http://www.w3.org/2000/svg":m=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(f=0;f<i.length;f++)if((p=i[f])&&"setAttribute"in p==!!m&&(m?p.localName==m:p.nodeType==3)){e=p,i[f]=null;break}}if(e==null){if(m==null)return document.createTextNode(d);e=document.createElementNS(o,m,d.is&&d),l&&(T.__m&&T.__m(t,i),l=!1),i=null}if(m==null)_===d||l&&e.data==d||(e.data=d);else{if(i=i&&ve.call(e.childNodes),_=r.props||ee,!l&&i!=null)for(_={},f=0;f<e.attributes.length;f++)_[(p=e.attributes[f]).name]=p.value;for(f in _)if(p=_[f],f!="children"){if(f=="dangerouslySetInnerHTML")s=p;else if(!(f in d)){if(f=="value"&&"defaultValue"in d||f=="checked"&&"defaultChecked"in d)continue;ce(e,f,null,p,o)}}for(f in d)p=d[f],f=="children"?u=p:f=="dangerouslySetInnerHTML"?h=p:f=="value"?v=p:f=="checked"?g=p:l&&typeof p!="function"||_[f]===p||ce(e,f,p,_[f],o);if(h)l||s&&(h.__html==s.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(s&&(e.innerHTML=""),Dt(t.type=="template"?e.content:e,_e(u)?u:[u],t,r,n,m=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:r.__k&&K(r,0),l,c),i!=null)for(f=i.length;f--;)Oe(i[f]);l||(f="value",m=="progress"&&v==null?e.removeAttribute("value"):v!=null&&(v!==e[f]||m=="progress"&&!v||m=="option"&&v!=_[f])&&ce(e,f,v,_[f],o),f="checked",g!=null&&g!=e[f]&&ce(e,f,g,_[f],o))}return e}function He(e,t,r){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(o){T.__e(o,r)}}function kt(e,t,r){var n,o;if(T.unmount&&T.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||He(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){T.__e(i,t)}n.base=n.__P=null}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&kt(n[o],t,r||typeof e.type!="function");r||Oe(e.__e),e.__c=e.__=e.__e=void 0}function Qr(e,t,r){return this.constructor(e,r)}function Lt(e,t,r){var n,o,i,a;t==document&&(t=document.documentElement),T.__&&T.__(e,t),o=(n=typeof r=="function")?null:r&&r.__k||t.__k,i=[],a=[],Fe(t,e=(!n&&r||t).__k=y(L,null,[e]),o||ee,ee,t.namespaceURI,!n&&r?[r]:o?null:t.firstChild?ve.call(t.childNodes):null,i,!n&&r?r:o?o.__e:t.firstChild,n,a),Rt(i,e,a)}function Ut(e){function t(r){var n,o;return this.getChildContext||(n=new Set,(o={})[t.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&n.forEach(function(a){a.__e=!0,Ne(a)})},this.sub=function(i){n.add(i);var a=i.componentWillUnmount;i.componentWillUnmount=function(){n&&n.delete(i),a&&a.call(i)}}),r.children}return t.__c="__cC"+At++,t.__=e,t.Provider=t.__l=(t.Consumer=function(r,n){return r.children(n)}).contextType=t,t}ve=Ct.slice,T={__e:function(e,t,r,n){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,n||{}),a=o.__d),a)return o.__E=o}catch(l){e=l}throw e}},Pt=0,Kr=function(e){return e!=null&&e.constructor==null},he.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=k({},this.state),typeof e=="function"&&(e=e(k({},r),this.props)),e&&k(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ne(this))},he.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ne(this))},he.prototype.render=L,V=[],Et=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,It=function(e,t){return e.__v.__b-t.__v.__b},de.__r=0,bt=/(PointerCapture)$|Capture$/i,$e=0,Le=St(!1),Ue=St(!0),At=0;var G,P,Be,Nt,ge=0,jt=[],I=T,$t=I.__b,Ot=I.__r,Ft=I.diffed,Ht=I.__c,Bt=I.unmount,qt=I.__;function ye(e,t){I.__h&&I.__h(P,e,ge||t),ge=0;var r=P.__H||(P.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function Xt(e,t,r){var n=ye(G++,2);if(n.t=e,!n.__c&&(n.__=[r?r(t):rn(void 0,t),function(l){var c=n.__N?n.__N[0]:n.__[0],f=n.t(c,l);c!==f&&(n.__N=[f,n.__[1]],n.__c.setState({}))}],n.__c=P,!P.__f)){var o=function(l,c,f){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(u){return!!u.__c});if(h.every(function(u){return!u.__N}))return!i||i.call(this,l,c,f);var s=n.__c.props!==l;return h.forEach(function(u){if(u.__N){var p=u.__[0];u.__=u.__N,u.__N=void 0,p!==u.__[0]&&(s=!0)}}),i&&i.call(this,l,c,f)||s};P.__f=!0;var i=P.shouldComponentUpdate,a=P.componentWillUpdate;P.componentWillUpdate=function(l,c,f){if(this.__e){var h=i;i=void 0,o(l,c,f),i=h}a&&a.call(this,l,c,f)},P.shouldComponentUpdate=o}return n.__N||n.__}function F(e,t){var r=ye(G++,3);!I.__s&&Jt(r.__H,t)&&(r.__=e,r.u=t,P.__H.__h.push(r))}function te(e){return ge=5,Kt(function(){return{current:e}},[])}function Kt(e,t){var r=ye(G++,7);return Jt(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function Gt(e,t){return ge=8,Kt(function(){return e},t)}function Zt(e){var t=P.context[e.__c],r=ye(G++,9);return r.c=e,t?(r.__==null&&(r.__=!0,t.sub(P)),t.props.value):e.__}function en(){for(var e;e=jt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(me),e.__H.__h.forEach(qe),e.__H.__h=[]}catch(t){e.__H.__h=[],I.__e(t,e.__v)}}I.__b=function(e){P=null,$t&&$t(e)},I.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),qt&&qt(e,t)},I.__r=function(e){Ot&&Ot(e),G=0;var t=(P=e.__c).__H;t&&(Be===P?(t.__h=[],P.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(me),t.__h.forEach(qe),t.__h=[],G=0)),Be=P},I.diffed=function(e){Ft&&Ft(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(jt.push(t)!==1&&Nt===I.requestAnimationFrame||((Nt=I.requestAnimationFrame)||tn)(en)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Be=P=null},I.__c=function(e,t){t.some(function(r){try{r.__h.forEach(me),r.__h=r.__h.filter(function(n){return!n.__||qe(n)})}catch(n){t.some(function(o){o.__h&&(o.__h=[])}),t=[],I.__e(n,r.__v)}}),Ht&&Ht(e,t)},I.unmount=function(e){Bt&&Bt(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{me(n)}catch(o){t=o}}),r.__H=void 0,t&&I.__e(t,r.__v))};var Vt=typeof requestAnimationFrame=="function";function tn(e){var t,r=function(){clearTimeout(n),Vt&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(r,100);Vt&&(t=requestAnimationFrame(r))}function me(e){var t=P,r=e.__c;typeof r=="function"&&(e.__c=void 0,r()),P=t}function qe(e){var t=P;e.__c=e.__(),P=t}function Jt(e,t){return!e||e.length!==t.length||t.some(function(r,n){return r!==e[n]})}function rn(e,t){return typeof t=="function"?t(e):t}function xe(e,t){e({type:"SET_VISIBILITY",payload:t})}function we(e,t){e({type:"SET_POSITION",payload:t})}function Ve(e,t){e({type:"SET_TEXTAREA",payload:t})}function Yt(e,t){e({type:"SET_TAB",payload:t})}function re(e,t,r){e({type:"SET_ITEMS",payload:{type:t,items:r}})}function Te(e,t){e({type:"SET_SELECTED_ITEM",payload:t})}function Qt(e,t,r){e({type:"SET_MESSAGE",payload:{type:t,message:r}})}var er=()=>{let{state:e}=C();return e.status==="success"&&e.selectedItem&&e.type==="lora"&&y("div",{className:"preview"},y("img",{src:e.selectedItem?e.selectedItem.previewFile??void 0:""}))};var Ge=_t(je());function Pe(e,t){let r=null,n=null,o=null,i=!1;return(...a)=>{let l=Date.now();!n||l-n>=t?(e(...a),i=!1):(i=!0,o=a),n=l,r&&clearTimeout(r),r=setTimeout(()=>{i&&o&&e(...o),n=null,i=!1},t)}}function tr(e){return Math.abs(e)>=1e12?(e/1e12).toFixed(1)+"T":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"G":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}var R,H,ne,oe;function rr(e){e&&(ne=new Set,window.opts[`${E}_always_underscore_tags`].split(/[\n,]/).forEach(t=>{t=t.trim().replace(/_/g," "),t&&ne.add(t)}),oe=new Set,window.opts[`${E}_always_space_tags`].split(/[\n,]/).forEach(t=>{t=t.trim().replace(/_/g," "),t&&oe.add(t)}),R={},Object.entries(e.tagModels).forEach(([t,r])=>{let n=t.split(/[ _-]/g),o=R[t]??{value:t,values:t.split(/[ _-]/g),flatValue:n.join(""),category:r.category,useCount:r.use_count,postCount:r.post_count,consequentTagModel:void 0,isOfficial:!0};o.isOfficial=!0;for(let i of r.aliases){let a=i.split(/[ _-]/g),l=R[i]??{value:i,values:i.split(/[ _-]/g),flatValue:a.join(""),category:r.category,useCount:r.use_count,postCount:r.post_count,consequentTagModel:o,isOfficial:!1};l.isOfficial?l.consequentTagModel=o:R[i]=l}R[t]=o}),nn(R))}function nr(e,t=3){let r=new Set;for(let n of e.split(/[ _-]/g)){let o=Math.min(t,n.length);for(let i=1;i<=o;i++)r.add(n.substring(0,i))}return r}function nn(e){H={};for(let t of Object.values(e)){let r=nr(t.value,3);for(let n of r)n in H||(H[n]={}),H[n][t.value]=t}}function on(e){if(e.value&&e.value in R)return;R[e.value]=e;let t=nr(e.value,3);for(let r of t)r in H||(H[r]={}),H[r][e.value]=e}function or(e){return R[e]}function ir(e,t){let r=e.toLowerCase().split(/[ _-]/g).filter(s=>s.trim()!==""),n;r.length>1&&(n=r.join(""));let o=new Set(t),i=[],a={};r.forEach(s=>{let u=s.length>3?s.slice(0,3):s,p=H[u];for(let v in p){if(v in a)continue;let g=p[v],_=[];if(n&&g.value.startsWith(n))for(let d=0;d<r.length;d++)_.push({word:r[d],index:d});else{let d={};for(let m of r){if(!(0 in d)&&g.flatValue.startsWith(m)){_.push({word:m,index:0}),d[0]=!0;continue}for(let w=0;w<g.values.length;w++)if(!(w in d)&&g.values[w].startsWith(m)){_.push({word:m,index:w}),d[w]=!0;break}}}if(_.length>0){let d={...g,isPriority:o.has(g.value),matchedWords:_,view:null,previewFile:""};i.push(d),a[v]=!0}}});let l=i.filter(s=>!s.consequentTagModel).reduce((s,u)=>(s[u.value]=u.matchedWords.length,s),{});i=i.filter(s=>{if(!s.consequentTagModel)return!0;let u=s.consequentTagModel.value;return!(u in l)||l[u]<s.matchedWords.length});let c={},f={};i.forEach(s=>{s.matchedWords.forEach(u=>{c[u.word]||(c[u.word]=0),c[u.word]+=1})}),i.forEach(s=>{f[s.value]=s.matchedWords.reduce((u,p)=>u+c[p.word],0)}),i=i.sort((s,u)=>sn(s,u,e,n,r,f));let h={};for(let s of["0","1","3","4","5","custom"])h[s]=window.opts[`${E}_max_results_group${s}`];return i.filter(s=>h[s.category]<0||h[s.category]>0?(h[s.category]-=1,!0):!1)}function sn(e,t,r,n,o,i){if(e.isPriority&&!t.isPriority)return-1;if(!e.isPriority&&t.isPriority)return 1;if(e.value===r||n&&e.value===n)return-1;if(t.value===r||n&&t.value===n)return 1;if(t.matchedWords.length!==e.matchedWords.length)return t.matchedWords.length-e.matchedWords.length;if(o.length===e.matchedWords.length){for(let l=0;l<e.matchedWords.length;l++)if(e.matchedWords[l].index!==t.matchedWords[l].index)return e.matchedWords[l].index-t.matchedWords[l].index}if(t.useCount!==e.useCount)return t.useCount-e.useCount;let a=i[e.value]-i[t.value];return a!==0?a:t.postCount!==e.postCount?t.postCount-e.postCount:e.value<t.value?-1:1}var sr=Pe((e,t)=>{let n="https://danbooru.donmai.us/autocomplete.json";n+=`?search[query]=${encodeURIComponent(e)}`,n+="&search[type]=tag",n+="&limit=50",n+="&version=1";let o=[];fetch(n).then(async i=>{if(!i.ok){console.error("Error fetching tag data:",i.statusText),t(o);return}o=(await i.json()).map(l=>{let c,f=null;return l.antecedent?(c=l.antecedent,f=R[l.label]):c=l.label,{value:c,category:l.category.toString(),matchedWords:[],useCount:0,postCount:l.post_count,consequentTagModel:f,isOfficial:f===void 0,isPriority:!1,view:null,previewFile:null}}),o.forEach(l=>{let c=l.value.split(/[ _-]/g);on({...l,values:c,flatValue:c.join("")})}),t(o)}).catch(i=>{console.error("Error fetching tag data:",i),t(o)})},1100);function Ee(e){let t;if(e.selectedItem&&(t=e.selectedItem),!t)return;let r;if(e.type==="tag")r=an(e,t);else if(e.type==="lora")r=ln(e,t);else if(e.type==="simple")r=un(e,t);else return;let n=window.opts[`${E}_using_execCommand`],o=e.textarea;if(n)o.focus(),o.setSelectionRange(r.range.start,r.range.end),document.execCommand("insertText",!1,r.insertText);else{let i=o.value;o.value=i.slice(0,r.range.start)+r.insertText+i.slice(r.range.end)}o.selectionStart=o.selectionEnd=r.range.start+r.insertText.length}function an(e,t){let{promptInfo:r,insertionInfo:n}=e.parseResult,i=r.words[r.activeWordIndex].position,a=-1,l=[];l.push(t.value),t.consequentTagModel&&l.push(t.consequentTagModel.value);let c=r.prompt.substring(i,r.caretPosition);for(let p of cn(c,/[ _-]/g))for(let v of l){if(p.word==="")continue;let g=Ke(fn(p.word)),_=new RegExp(`(?:^|[ _-])${g}`,"gi").exec(v);_&&_.index!==-1&&(a===-1||a>p.position)&&(a=p.position)}a>-1&&(i+=a);let f=t.isOfficial?t.value:t.consequentTagModel.value,h=window.opts[`${E}_tag_source`].replace(/\./g,"_"),s=window.opts[`${E}_${h}_${t.category}_tag_delimiter`]??"auto";if(!oe.has(f)){let p=!1;ne.has(f)||s==="underscore"?p=!0:s==="auto"&&(p=r.inputtingString.includes("_")),p&&(f=f.replace(/ /g,"_"))}return n.needPrependComma?f=", "+f:a<=0&&n.needPrependSpace&&(f=" "+f),f=ar(f),window.opts[`${E}_append_comma`]&&(f+=","),f+=" ",{range:{start:i,end:r.caretPosition},insertText:f}}function ln(e,t){let{promptInfo:r}=e.parseResult,o=r.words[r.activeWordIndex].position,i=t.value,a=r.prompt.substring(o).match(/^<(?:lora|lyco):[^<>:]+(:.+>)/i),l=r.caretPosition;return a?(l=o+a[0].length,i+=a[1]):i+=":1>",i+=" ",{range:{start:o,end:l},insertText:i}}function un(e,t){let{promptInfo:r,insertionInfo:n}=e.parseResult,i=r.words[r.activeWordIndex].position,l=or(t.value)?.category??"custom",c=ar(t.value),f=window.opts[`${E}_tag_source`].replace(/\./g,"_"),h=window.opts[`${E}_${f}_${l}_tag_delimiter`]??"auto";if(!oe.has(c)){let u=!1;ne.has(c)||h==="underscore"?u=!0:h==="auto"&&(u=r.inputtingString.includes("_")),u&&(c=c.replace(/ /g,"_"))}return n.needPrependComma?c=", "+c:n.needPrependSpace&&(c=" "+c),window.opts[`${E}_append_comma`]&&(c+=","),c+=" ",{range:{start:i,end:r.caretPosition},insertText:c}}function Ke(e){return e.replace(/[.*+?^${}()|\[\]\\]/g,"\\$&")}function ar(e){return e.replace(/[{}()\[\]\\]/g,"\\$&")}function fn(e){let t="";for(let r=0;r<e.length;r++)e[r]==="\\"?r+1<e.length?(t+=e[r+1],r++):t+="\\":t+=e[r];return t}function cn(e,t){let r=[],n=t,o,i=0;for(;(o=n.exec(e))!==null;)r.push({word:e.slice(i,o.index),position:i}),i=n.lastIndex;return r.push({word:e.slice(i),position:i}),r}var ie=e=>{if(e){e=e.replace(" ","_"),/^[0-9]+$/.test(e)&&(e=`~${e}`);let t=window.opts[`${E}_tag_source`];window.open(`https://${t}/wiki_pages/${encodeURIComponent(e)}`)}};var lr=()=>{let{state:e,dispatch:t}=C();F(()=>{if(e.selectedItem){let a=document.querySelector("#suggestion-box li.selected");a&&a.scrollIntoView({block:"nearest"})}},[e.selectedItem]);let r=e.items.filter(a=>e.selectedCategory==="all"||String(a.category)===e.selectedCategory),n=a=>{let c=a.target.closest("li");if(c){let f=r[+c.dataset.index];f&&(e.selectedItem===null||e.selectedItem.value!==f.value)&&Te(t,f)}},o=a=>{let l=a.target,c=l.closest("li");if(c){a.stopPropagation();let f=r[+c.dataset.index];if(Ee(e),l instanceof HTMLAnchorElement){let h=f.isOfficial?f.value:f.consequentTagModel.value;ie(h)}xe(t,!1)}},i;return e.status==="loading"?i="Loading models...":e.status==="error"?i="An error occurred. Please reload the page.":e.message&&(i=e.message),y("ul",{key:`${e.selectedCategory}_${i}_${r.length}`,class:"list-container",onMouseMove:a=>n(a),onMouseDown:a=>o(a)},i&&y("li",{key:i,className:"notice","data-type":""},i),!i&&r.map((a,l)=>y("li",{key:a.value,className:(0,Ge.default)(`group${a.category}`,e.selectedItem&&e.selectedItem.value===a.value?"selected":""),"data-index":l},e.type==="tag"&&y("span",{className:(0,Ge.default)("highlight",a.useCount>0?"recommend":null)}),e.type==="tag"&&y("a",{className:"wiki",style:{visibility:a.postCount>0?"":"hidden"}},"?"),y("span",{className:"title"},y(pn,{item:a})),e.type==="tag"&&a.postCount>0&&y("span",{className:"post-count"},tr(a.postCount)))))},pn=({item:e})=>{let t=r=>{let n=[r];return e.matchedWords.forEach((o,i)=>{let a=Ke(o.word),l=new RegExp(`(${a})`,"gi"),c=[];n.forEach((f,h)=>{typeof f=="string"?f.split(l).forEach((u,p)=>{p%2===1?c.push(y("b",{key:`${i}-${h}-${p}`},u)):u&&c.push(u)}):c.push(f)}),n=c}),n};return y(L,null,t(e.value),e.consequentTagModel&&y(L,null,y("span",null),t(e.consequentTagModel.value)))};var Ze=_t(je());var ur=()=>{let{state:e,dispatch:t}=C(),r=o=>{Yt(t,o)},n=[["all","ALL"],["0","Gen"],["1","Art"],["3","Copy"],["4","Chara"],["5","Meta"]];return y("div",{className:(0,Ze.default)("tab-container",e.status==="success"&&e.type==="tag"?"":"no-tab")},n.map(([o,i])=>y("div",{key:o,className:(0,Ze.default)("tab",`group${o}`,e.selectedCategory===o?"selected":""),onClick:()=>r(o)},i)))};function fr(e){if(!e.isVisible||!e.textarea)return!1;let{promptInfo:t,insertionInfo:r}=e.parseResult;return!(r.isMetaBlock||t.activeWordIndex>=0&&t.words[t.activeWordIndex].type==="lora"&&t.inputtingString===""||!window.opts[`${E}_suggest_enabled`]&&t.inputtingString==="")}function Ie(e){let t=e.textarea;if(!t)return{offset_x:0,offset_y:0,x:0,y:0};let r=t.dummy,n=r.caret,o=t.selectionEnd,i=t.value.slice(0,o),a=t.value.slice(o);r.textContent=i,n.textContent=a[0]||"\u200B",r.appendChild(n);let l=n.getBoundingClientRect(),c=window.getComputedStyle(t),f=parseFloat(c.lineHeight.replace(/[^\d\.]+/,"")),h=t.getBoundingClientRect(),s=l.left-h.left-t.scrollLeft,u=l.top-h.top-t.scrollTop+f;return{offset_y:h.top+window.scrollY,offset_x:h.left+window.scrollX,x:s,y:u}}var cr=({offset_x:e,offset_y:t,x:r,y:n})=>({top:`${t}px`,left:`${e}px`,transform:`translate(${r}px, ${n}px)`}),pr=e=>fr(e)?{}:{display:"none"};var hr={"(":"paren","[":"square","{":"curly","<":"lora"},hn={")":"paren","]":"square","}":"curly",">":"lora"},dn={root:"",paren:")",square:"]",curly:"}",lora:">"},vn={root:new Set([","]),paren:new Set([","]),square:new Set([",",":","|"]),curly:new Set([",","|"]),lora:new Set},_n=new Set([",","|",":","(","[","{","<"]),be=5,mn=["BREAK","AND","ADDCOMM","ADDBASE","ADDCOL","ADDROW"],gn=/\{([\d-]+\$\$(?:[^\}]+?\$\$)?)(.*)\}/g,yn=new RegExp(`\\b(${mn.join("|")})\\b`,"g");function Z(e,t){return{value:"",position:t,type:e==="lora"?"lora":"tag",isActive:!1}}function Ae(e,t){let r={prompt:e,caretPosition:t,inputtingString:"",activeWordIndex:-1,words:[]},n={isMetaBlock:!1,needPrependComma:!1,needPrependSpace:!1};e=e.replace(yn,p=>",".padEnd(p.length,"\0")),e=e.replace(gn,(p,v,g)=>`{${"\0".repeat(v.length)}${g}}`);let o=["root"],i=!1,a,l=!0;function c(p){p.value=p.value.trim(),(p.isActive||p.value!=="")&&(r.words.push(p),l=!1,a=void 0)}function f(p){p===`
`?l=!0:_n.has(p)&&(a=p)}function h(p){p.isActive&&r.words.length>0&&(a===void 0?(n.needPrependComma=!0,l||(n.needPrependSpace=!0)):a===","&&(n.needPrependSpace=!0))}function s(p){p.isActive=!0;let v=r.inputtingString;i&&(v+="\\",r.inputtingString=v),r.inputtingString=p.value.trim(),r.activeWordIndex=r.words.length}let u=Z("root",0);for(let p=0;p<e.length;p++){let v=e[p];p===t&&s(u);let g=o[o.length-1];if(v==="\0"){u.isActive&&(n.isMetaBlock=!0,n.needPrependSpace=!0),u.position++;continue}if(v===`
`){h(u),c(u),f(v),u=Z(g,p+1),i=!1;continue}if(i){u.value+=v,i=!1;continue}if(v==="\\"){i=!0;continue}if(v in hr){let _=hr[v];if(_==="lora"&&(_="root",e.length-p>be)){let d=e.substring(p+1,p+be+1);(d==="lora:"||d==="lyco:")&&(_="lora")}if(_!=="root"){o.push(_),_==="lora"&&(p+=be,p-t>=0&&p-t<be&&(n.isMetaBlock=!0)),h(u),c(u),f(v),_==="lora"?u=Z(_,p+1):u=Z(_,p);continue}}if(v in hn){let _=dn[g];if(v!==_){u.value+=v;continue}if(g==="paren"||g==="square"){let d=u.value.lastIndexOf(":");if(d>=0){let m=u.value.substring(0,d),w=u.value.substring(d+1);dr(w)&&(u.value=m,u.isActive&&p-t<=w.length&&(n.isMetaBlock=!0))}else g==="square"&&dr(u.value)&&(u.isActive&&p-t<=u.value.length&&(n.isMetaBlock=!0),u.value="")}else if(g==="lora"){let d=u.value.indexOf(":");if(d>=0){let m=u.value.substring(0,d),w=u.value.substring(d+1);u.isActive&&p-t<=w.length&&(n.isMetaBlock=!0),u.value=m}}o.pop(),h(u),c(u),f(v),u=Z(o[o.length-1],p+1);continue}if(g==="lora"){(u.value!==""||v!==" ")&&(u.value+=v);continue}if(vn[g]?.has(v)){h(u),c(u),f(v),u=Z(g,p+1);continue}u.value===""&&(u.position=p),u.value+=v}return r.activeWordIndex<0&&s(u),r.words.forEach(p=>{p.value=p.value.replace(/_/g," ")}),h(u),c(u),{promptInfo:r,insertionInfo:n}}function dr(e){return e.trim()===""?!1:!isNaN(+e)}function Je(e,t,r=[]){let{state:n}=C();F(()=>{if(!window.pilotIsActive||!n.textarea)return;let o=t;return n.textarea.addEventListener(e,o),()=>{n.textarea?.removeEventListener(e,o)}},[n.textarea,e,t,...r])}var Ye=(e,t,r=[])=>Je(e,t,r),Ce=(e,t,r=[])=>Je(e,t,r),Qe=(e,t,r=[])=>Je(e,t,r);var et;function _r(e){e&&(et={},Object.entries(e.suggestionModels).forEach(([t,r])=>{let n=Object.entries(r).sort(([,o],[,i])=>i-o);et[t]=n.map(([o,i])=>({value:o,count:i}))}))}function tt(e,t){if(!e)return[];let r=et[e];if(!r)return[];let n=[];for(let o of r)t.has(o.value)||n.push({...o,view:null,isPriority:!1,matchedWords:[],category:"",useCount:0,postCount:0,consequentTagModel:null,isOfficial:!1,previewFile:null});return n}function xn(e){let t=e.textarea;return Ae(t.value,t.selectionEnd)}function wn(e){return new Set(e.words.filter((t,r)=>r!==e.activeWordIndex&&t.type!=="lora").map(t=>t.value))}function Tn(e){for(let t=e.activeWordIndex-1;t>=0;t--){let r=e.words[t];if(r.type!=="lora")return r.value}}function Sn(e,t,r){let n=tt(t,r),o=[];for(let i of n)i.value.startsWith(e)&&o.push(i.value);return o}function Pn(e,t,r,n){if(e===""){let i=tt(t,r);re(n,"simple",i);return}let o=Sn(e,t,r);if(e.startsWith("*")&&e.length>1)sr(e.substring(1),i=>{re(n,"tag",i)}),Qt(n,"tag","Searching for tags via API...");else{let i=ir(e,o);re(n,"tag",i)}}function En(e,t){let r=xt(e);re(t,"lora",r)}function gr(e,t){let r=xn(e);if(e.status!=="success"){t({type:"SET_VISIBILITY",payload:!0});return}t({type:"SET_PARSE_RESULT",payload:r});let{promptInfo:n}=r,o=n.words[n.activeWordIndex],i=n.inputtingString,a=wn(n);if(o.type!=="lora"){let l=Tn(n);Pn(i,l,a,t)}else En(i,t)}var rt=Pe(gr,gt),nt,yr=()=>{let{state:e,dispatch:t}=C(),r=te(!1),n=te(!1);return Ye("mousedown",o=>{o.ctrlKey&&setTimeout(()=>{nt=new Promise(i=>{let a=e.textarea,l=Ae(a.value,a.selectionEnd);t({type:"SET_PARSE_RESULT",payload:l});let{promptInfo:c}=l,f=c.words[c.activeWordIndex];i(f)})},50)},[e.textarea]),Ye("mouseup",o=>{o.ctrlKey&&nt&&nt.then(i=>{i.type==="tag"&&ie(i.value)})},[e.textarea]),Qe("compositionstart",()=>{n.current=!0},[e.textarea]),Qe("compositionend",()=>{n.current=!1,r.current||(we(t,Ie(e)),rt(e,t))},[e.textarea]),Ce("input",()=>{r.current||n.current||(we(t,Ie(e)),rt(e,t))},[e.textarea,e.isVisible,e.status]),Ce("keydown",o=>{let i=o.key;if(o.ctrlKey&&(i==="ArrowDown"||i==="ArrowUp")){r.current=!0;return}if(e.isVisible&&!n.current){if(i==="Escape"){xe(t,!1),o.preventDefault(),o.stopPropagation();return}if(e.items.length){if(i==="Tab"){let a=e.selectedItem;if(a&&(Ee(e),o.shiftKey&&e.type==="tag")){let l=a;if(l.isOfficial!==void 0){let c=l.isOfficial?l.value:l.consequentTagModel.value;ie(c)}}o.preventDefault()}else if((i==="ArrowDown"||i==="ArrowUp")&&!o.ctrlKey&&!o.shiftKey){let a=i==="ArrowDown"?1:-1,l=e.items.filter(h=>e.selectedCategory==="all"||String(h.category)===e.selectedCategory),c=-1;e.selectedItem&&(c=l.findIndex(h=>h.value===e.selectedItem.value));let f=(c+a+l.length)%l.length;Te(t,l[f]),o.preventDefault()}}}},[e.textarea,e.isVisible,e.items,e.selectedItem,e.selectedCategory,e.parseResult]),Ce("keyup",o=>{if(r.current=!1,!e.isVisible||n.current)return;let i=o.key;["ArrowLeft","ArrowRight","Home","End"].includes(i)&&(we(t,Ie(e)),rt(e,t),o.preventDefault())},[e.textarea,e.isVisible]),null};var b=Uint8Array,J=Uint16Array,In=Int32Array,xr=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wr=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bn=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tr=function(e,t){for(var r=new J(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var o=new In(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return{b:r,r:o}},Sr=Tr(xr,2),Pr=Sr.b,An=Sr.r;Pr[28]=258,An[258]=28;var Er=Tr(wr,0),Cn=Er.b,Oo=Er.r,st=new J(32768);for(x=0;x<32768;++x)U=(x&43690)>>1|(x&21845)<<1,U=(U&52428)>>2|(U&13107)<<2,U=(U&61680)>>4|(U&3855)<<4,st[x]=((U&65280)>>8|(U&255)<<8)>>1;var U,x,se=function(e,t,r){for(var n=e.length,o=0,i=new J(t);o<n;++o)e[o]&&++i[e[o]-1];var a=new J(t);for(o=1;o<t;++o)a[o]=a[o-1]+i[o-1]<<1;var l;if(r){l=new J(1<<t);var c=15-t;for(o=0;o<n;++o)if(e[o])for(var f=o<<4|e[o],h=t-e[o],s=a[e[o]-1]++<<h,u=s|(1<<h)-1;s<=u;++s)l[st[s]>>c]=f}else for(l=new J(n),o=0;o<n;++o)e[o]&&(l[o]=st[a[e[o]-1]++]>>15-e[o]);return l},ae=new b(288);for(x=0;x<144;++x)ae[x]=8;var x;for(x=144;x<256;++x)ae[x]=9;var x;for(x=256;x<280;++x)ae[x]=7;var x;for(x=280;x<288;++x)ae[x]=8;var x,Ir=new b(32);for(x=0;x<32;++x)Ir[x]=5;var x;var Mn=se(ae,9,1);var Dn=se(Ir,5,1),ot=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},D=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},it=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},zn=function(e){return(e+7)/8|0},Rn=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new b(e.subarray(t,r))};var Wn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],z=function(e,t,r){var n=new Error(t||Wn[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,z),!r)throw n;return n},kn=function(e,t,r,n){var o=e.length,i=n?n.length:0;if(!o||t.f&&!t.l)return r||new b(0);var a=!r,l=a||t.i!=2,c=t.i;a&&(r=new b(o*3));var f=function(pt){var ht=r.length;if(pt>ht){var dt=new b(Math.max(ht*2,pt));dt.set(r),r=dt}},h=t.f||0,s=t.p||0,u=t.b||0,p=t.l,v=t.d,g=t.m,_=t.n,d=o*8;do{if(!p){h=D(e,s,1);var m=D(e,s+1,3);if(s+=3,m)if(m==1)p=Mn,v=Dn,g=9,_=5;else if(m==2){var W=D(e,s,31)+257,Y=D(e,s+10,15)+4,B=W+D(e,s+5,31)+1;s+=14;for(var M=new b(B),q=new b(19),S=0;S<Y;++S)q[bn[S]]=D(e,s+S*3,7);s+=Y*3;for(var $=ot(q),kr=(1<<$)-1,Lr=se(q,$,1),S=0;S<B;){var at=Lr[D(e,s,kr)];s+=at&15;var w=at>>4;if(w<16)M[S++]=w;else{var j=0,le=0;for(w==16?(le=3+D(e,s,3),s+=2,j=M[S-1]):w==17?(le=3+D(e,s,7),s+=3):w==18&&(le=11+D(e,s,127),s+=7);le--;)M[S++]=j}}var lt=M.subarray(0,W),O=M.subarray(W);g=ot(lt),_=ot(O),p=se(lt,g,1),v=se(O,_,1)}else z(1);else{var w=zn(s)+4,A=e[w-4]|e[w-3]<<8,N=w+A;if(N>o){c&&z(0);break}l&&f(u+A),r.set(e.subarray(w,N),u),t.b=u+=A,t.p=s=N*8,t.f=h;continue}if(s>d){c&&z(0);break}}l&&f(u+131072);for(var Ur=(1<<g)-1,Nr=(1<<_)-1,De=s;;De=s){var j=p[it(e,s)&Ur],X=j>>4;if(s+=j&15,s>d){c&&z(0);break}if(j||z(2),X<256)r[u++]=X;else if(X==256){De=s,p=null;break}else{var ut=X-254;if(X>264){var S=X-257,Q=xr[S];ut=D(e,s,(1<<Q)-1)+Pr[S],s+=Q}var ze=v[it(e,s)&Nr],Re=ze>>4;ze||z(3),s+=ze&15;var O=Cn[Re];if(Re>3){var Q=wr[Re];O+=it(e,s)&(1<<Q)-1,s+=Q}if(s>d){c&&z(0);break}l&&f(u+131072);var ft=u+ut;if(u<O){var ct=i-O,$r=Math.min(O,ft);for(ct+u<0&&z(3);u<$r;++u)r[u]=n[ct+u]}for(;u<ft;++u)r[u]=r[u-O]}}t.l=p,t.p=De,t.b=u,t.f=h,p&&(h=1,t.m=g,t.d=v,t.n=_)}while(!h);return u!=r.length&&a?Rn(r,0,u):r.subarray(0,u)};var Ln=new b(0);var Un=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&z(6,"invalid gzip data");var t=e[3],r=10;t&4&&(r+=(e[10]|e[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(t&2)},Nn=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0};function br(e,t){var r=Un(e);return r+8>e.length&&z(6,"invalid gzip data"),kn(e.subarray(r,-8),{i:2},t&&t.out||new b(Nn(e)),t&&t.dictionary)}var $n=typeof TextDecoder<"u"&&new TextDecoder,On=0;try{$n.decode(Ln,{stream:!0}),On=1}catch{}var Ar=async()=>{try{let e=await fetch("file=extensions/sd-webui-prompt-pilot/models.json.gz");if(!e.ok)return{success:!1};let t=new Uint8Array(await e.arrayBuffer()),r=br(t),n=new TextDecoder("utf-8").decode(r);return{success:!0,data:JSON.parse(n)}}catch(e){return console.error(e),{success:!1}}},Cr=e=>{rr(e),fe(e),_r(e)};var Me,Fn=new Promise(e=>{Me=e});onOptionsChanged(()=>{window.pilotIsActive=window.opts[`${E}_enabled`],Me&&(Me(!0),Me=null)});var Mr=e=>{F(()=>{(async()=>{let r=await Ar();if(r.success)try{await Fn,Cr(r.data),e({type:"SET_STATUS",payload:"success"})}catch(n){console.error(n),e({type:"SET_STATUS",payload:"error"})}})()},[e])};var Dr=()=>{let{state:e,dispatch:t}=C(),r=te(null);Mr(t);let n=Gt(o=>{let i=o.target;if(i.closest("#suggestion-box")){o.stopPropagation();return}i.matches(ue)?Ve(t,i):Ve(t,null),o.stopPropagation()},[t]);return F(()=>(document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)),[n]),y(L,null,y(yr,null),y("div",{id:"suggestion-box",ref:r,style:{...cr(e.pos),...pr(e)}},y(ur,null),y(lr,null),y(er,null)))};var zr=(e,t)=>t.type==="SET_TEXTAREA"?{...e,isVisible:!1,textarea:t.payload,selectedCategory:"all"}:t.type==="SET_VISIBILITY"?{...e,isVisible:t.payload,selectedCategory:"all"}:t.type==="SET_STATUS"?{...e,status:t.payload}:t.type==="SET_POSITION"?{...e,pos:{offset_x:t.payload.offset_x,offset_y:t.payload.offset_y,x:t.payload.x,y:t.payload.y}}:t.type==="SET_TAB"?{...e,selectedCategory:t.payload}:t.type==="SET_SELECTED_ITEM"?{...e,selectedItem:t.payload}:t.type==="SET_ITEMS"?{...e,isVisible:!0,type:t.payload.type,items:t.payload.items,selectedItem:t.payload.items.length>0?t.payload.items[0]:null,message:t.payload.items.length>0?"":"No results found"}:t.type==="SET_MESSAGE"?{...e,isVisible:!0,type:t.payload.type,message:t.payload.message}:t.type==="SET_PARSE_RESULT"?{...e,parseResult:t.payload}:e;var Rr=Ut(null),C=()=>{let e=Zt(Rr);if(!e)throw new Error("usePromptPilot must be used within a PromptPilotProvider");return e},Hn=({promptPilotState:e,children:t})=>{let[r,n]=Xt(zr,e);return y(Rr.Provider,{value:{state:r,dispatch:n}},t)};function Wr(e){Lt(y(Hn,{promptPilotState:e},y(Dr,null)),document.getElementById("prompt-pilot-container"))}window.pilotIsActive=!0;onUiLoaded(()=>{let e=gradioApp().querySelectorAll(ue),t=getComputedStyle(e[0]),r="",n=new Set(["width","height","inline-size","block-size","resize"]);for(let c=0;c<t.length;c++){let f=t[c];if(!n.has(f)){let h=t.getPropertyValue(f);r+=`${f}: ${h};`}}e.forEach(c=>{let f=c,h=document.createElement("div");h.className="prompt_pilot-dummy",f.parentNode?.insertBefore(h,f.nextSibling),f.dummy=h;let s=document.createElement("span");h.caret=s});let o=new CSSStyleSheet;o.replaceSync(`.prompt_pilot-dummy {${r}}`),document.adoptedStyleSheets=[...document.adoptedStyleSheets,o];let i=document.createElement("div");i.id="prompt-pilot-container",gradioApp().appendChild(i),Wr({isVisible:!1,status:"loading",type:"tag",textarea:null,selectedCategory:"all",selectedItem:null,items:[],pos:{offset_x:0,offset_y:0,x:0,y:0},parseResult:{promptInfo:{prompt:"",caretPosition:0,inputtingString:"",activeWordIndex:-1,words:[]},insertionInfo:{isMetaBlock:!1,needPrependComma:!1,needPrependSpace:!1}},message:""}),gradioApp().querySelectorAll(".extra-network-control--refresh").forEach(c=>{c.addEventListener("click",()=>{fetch(`${mt}/refresh`,{method:"POST"}).then(async f=>{let h=await f.json();fe(h)})})})});})();
/*! Bundled license information:

classnames/index.js:
  (*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  *)
*/
//# sourceMappingURL=prompt_pilot.js.map
